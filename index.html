<!-- index.html (FULL FILE REPLACEMENT) -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Setfeed</title>
  <meta name="description" content="Setfeed is a calm, local-first scheduled messaging app." />

  <meta name="theme-color" content="#FFFBFE" id="meta-theme-color" />

  <link rel="icon" href="./favicon.ico" sizes="any">
  <link rel="icon" type="image/png" href="./favicon-32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="./favicon-16.png" sizes="16x16">
  <link rel="apple-touch-icon" href="./apple-touch-icon.png" sizes="180x180">

  <link rel="stylesheet" href="./styles.css" />

  <!-- FIREBASE (AUTH + APP CHECK) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-check-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCECKG-00tijJrt5qvRy3L27ZzE7bocNrU",
      authDomain: "setfeed-fcd7a.firebaseapp.com",
      projectId: "setfeed-fcd7a",
      storageBucket: "setfeed-fcd7a.firebasestorage.app",
      messagingSenderId: "553573263069",
      appId: "1:553573263069:web:e5c9884101ca38eaee1d34"
    };

    // TODO: replace this with your real App Check reCAPTCHA v3 site key
    const RECAPTCHA_SITE_KEY = "6LfgvG0sAAAAANQjlRbdsWx6GMQw1kP2kuOPjeJI";

    firebase.initializeApp(firebaseConfig);

    function startAppCheck() {
      try {
        firebase.appCheck().activate(RECAPTCHA_SITE_KEY, true);
        console.log("[AppCheck] activated");
      } catch (e) {
        console.warn("[AppCheck] init failed:", e);
      }
    }
    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", startAppCheck, { once: true });
    } else {
      startAppCheck();
    }
  </script>

  <script>
    (function(){
      const THEME_KEY = "sf_theme_mode"; // "system" | "light" | "dark"
      const root = document.documentElement;

      function applyTheme(){
        const stored = localStorage.getItem(THEME_KEY) || "system";
        if (stored === "light" || stored === "dark") root.setAttribute("data-theme", stored);
        else root.removeAttribute("data-theme");

        const effective =
          root.getAttribute("data-theme") ||
          (window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light");

        const meta = document.getElementById("meta-theme-color");
        if (meta) meta.content = (effective === "dark") ? "#0F1114" : "#FFFBFE";
      }

      applyTheme();

      window.addEventListener("storage", (e) => {
        if (!e) return;
        if (e.key === THEME_KEY) applyTheme();
      });
    })();
  </script>

  <style>
    .hidden{ display:none !important; }
    .sr-only{
      position:absolute !important;
      width:1px !important;
      height:1px !important;
      padding:0 !important;
      margin:-1px !important;
      overflow:hidden !important;
      clip:rect(0,0,0,0) !important;
      white-space:nowrap !important;
      border:0 !important;
    }
    .sf-auth-row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      margin-top: 10px;
    }
    .sf-auth-pill{
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.06);
      color: rgba(233,238,246,0.9);
      font-weight: 600;
      font-size: 13px;
    }
    .sf-google-icon{
      width: 18px;
      height: 18px;
      display:inline-block;
    }
  </style>
</head>

<body class="page-bg">
  <header class="site-header">
    <div class="header-inner">
      <a class="brand-mark" href="./" aria-label="Setfeed home">
        <img class="logo" src="./logo.png" alt="" aria-hidden="true" />
      </a>

      <a class="brand-title" href="./">Setfeed</a>

      <nav class="nav" aria-label="Primary">
        <a href="./" aria-current="page">Home</a>
        <a href="./send.html">Send</a>
        <a href="./receive.html">Receive</a>
        <a class="auth-only hidden" href="./inbox.html">Inbox</a>
        <a href="./security.html">Security</a>
        <a href="./privacy.html">Privacy</a>
        <a class="nav-cta" href="#" aria-label="Download Setfeed app">Download app</a>
      </nav>
    </div>
  </header>

  <div class="wrap">
    <div class="card">
      <h1>Scheduled messages</h1>
      <p class="lead">
        A calm, local-first scheduled messaging app — predictable behavior, gentle defaults,
        and no surprise state changes.
      </p>

      <div class="pills" aria-label="Product principles">
        <div class="pill"><span class="dot ok"></span> Local-first</div>
        <div class="pill"><span class="dot ok"></span> Deterministic</div>
        <div class="pill"><span class="dot ok"></span> Encrypted web send</div>
      </div>

      <div class="actions" style="margin-top: var(--s-5);">
        <a class="btn btn-lg btn-primary" href="./send.html">Send a message</a>
        <a class="btn btn-lg btn-secondary" href="./receive.html">Get a receive code</a>
        <a class="btn btn-lg btn-quiet" href="./security.html">Security</a>
      </div>

      <div class="panel" style="margin-top: var(--s-6);">
        <p class="panel-sub" style="margin-top: 0;">
          Optional. Sign in to use Signed sending and advanced options.
        </p>

        <div class="actions">
          <button class="btn btn-lg btn-primary" id="btn-google" type="button" aria-label="Continue with Google">
            <span aria-hidden="true" class="sf-google-icon">
              <svg viewBox="0 0 48 48" width="18" height="18" role="img" aria-hidden="true">
                <path fill="#FFC107" d="M43.6 20.5H42V20H24v8h11.3C33.7 32.7 29.3 36 24 36c-6.6 0-12-5.4-12-12s5.4-12 12-12c3.1 0 5.9 1.2 8 3.1l5.7-5.7C34.1 6.1 29.3 4 24 4 12.9 4 4 12.9 4 24s8.9 20 20 20 20-8.9 20-20c0-1.1-.1-2.2-.4-3.5z"/>
                <path fill="#FF3D00" d="M6.3 14.7l6.6 4.8C14.7 16 19 12 24 12c3.1 0 5.9 1.2 8 3.1l5.7-5.7C34.1 6.1 29.3 4 24 4 16.3 4 9.6 8.3 6.3 14.7z"/>
                <path fill="#4CAF50" d="M24 44c5.2 0 10-2 13.6-5.2l-6.3-5.2C29.4 35.1 26.8 36 24 36c-5.3 0-9.7-3.3-11.3-8l-6.6 5.1C9.3 39.7 16.1 44 24 44z"/>
                <path fill="#1976D2" d="M43.6 20.5H42V20H24v8h11.3c-1.1 3-3.3 5.3-6 6.8l.1.1 6.3 5.2C39.4 36.9 44 31.9 44 24c0-1.1-.1-2.2-.4-3.5z"/>
              </svg>
            </span>
            <span>Continue with Google</span>
          </button>

          <!-- ✅ Hide this when signed in -->
          <a class="btn btn-lg btn-secondary" id="btn-email" href="./send.html#signin">Continue with email</a>

          <button class="btn btn-lg btn-quiet hidden" id="btn-signout" type="button">Sign out</button>
        </div>

        <div class="sf-auth-row">
          <span class="sf-auth-pill hidden" id="sf-auth-pill">
            <span aria-hidden="true">✓</span>
            <span id="sf-auth-label">Signed in</span>
          </span>
        </div>

        <small class="help">Rolling is always available without signing in.</small>
      </div>

      <h2>About this site</h2>
      <p>
        This website is a simple bridge for sending encrypted messages into Setfeed.
        Messages are encrypted before they reach our servers. The server stores ciphertext only.
      </p>

      <footer>
        <div>© <span id="y"></span> Setfeed</div>
        <div>
          <a href="./security.html">Security</a>
          <span class="sep">·</span>
          <a href="./privacy.html">Privacy</a>
          <span class="sep">·</span>
          <a href="mailto:security@setfeed.app">security@setfeed.app</a>
        </div>
      </footer>
    </div>
  </div>

  <script>
    document.getElementById("y").textContent = new Date().getFullYear();

    // -------------------------
    // Auth wiring (Google popup)
    // -------------------------
    const AUTH_KEY = "sf_signed_authed";
    const auth = firebase.auth();

    function setSignedAuthedFlag(isAuthed) {
      try { localStorage.setItem(AUTH_KEY, isAuthed ? "true" : "false"); } catch (_) {}
      document.querySelectorAll(".auth-only").forEach(el => el.classList.toggle("hidden", !isAuthed));
    }

    const btnGoogle = document.getElementById("btn-google");
    const btnEmail = document.getElementById("btn-email");
    const btnSignout = document.getElementById("btn-signout");
    const pill = document.getElementById("sf-auth-pill");
    const pillLabel = document.getElementById("sf-auth-label");

    function renderAuthed(user) {
      const isAuthed = !!user;
      setSignedAuthedFlag(isAuthed);

      btnGoogle.classList.toggle("hidden", isAuthed);
      btnSignout.classList.toggle("hidden", !isAuthed);

      // ✅ Hide “Continue with email” when signed in (your request)
      if (btnEmail) btnEmail.classList.toggle("hidden", isAuthed);

      if (pill && pillLabel) {
        pill.classList.toggle("hidden", !isAuthed);
        if (isAuthed) {
          const email = user.email || "Signed in";
          pillLabel.textContent = email;
        }
      }
    }

    auth.onAuthStateChanged((user) => {
      renderAuthed(user);
    });

    btnGoogle.addEventListener("click", async () => {
      try {
        const provider = new firebase.auth.GoogleAuthProvider();
        provider.setCustomParameters({ prompt: "select_account" });

        await auth.signInWithPopup(provider);
        window.location.href = "./send.html#signin";
      } catch (e) {
        console.error(e);
        alert("Couldn’t sign in with Google. Check your browser pop-up settings and try again.");
      }
    });

    btnSignout.addEventListener("click", async () => {
      try {
        await auth.signOut();
      } catch (e) {
        console.error(e);
        alert("Couldn’t sign out. Try again.");
      }
    });
  </script>
</body>
</html>
